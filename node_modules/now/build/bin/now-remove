#!/usr/bin/env node
"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r["default"]=e,r}function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function readConfirmation(e){return new _promise2["default"](function(r,t){var n=_chalk2["default"].gray((0,_ms2["default"])(new Date-e.created)+" ago"),a=(0,_textTable2["default"])([[e.uid,_chalk2["default"].underline("https://"+e.url),n]],{align:["l","r","l"],hsep:" ".repeat(6)});process.stdout.write("> The following deployment will be removed permanently\n"),process.stdout.write("  "+a+"\n"),process.stdout.write(_chalk2["default"].bold.red("> Are you sure?")+" "+_chalk2["default"].gray("[yN] ")),process.stdin.on("data",function(e){process.stdin.pause(),r(e.toString().trim())}).resume()})}var _regenerator=require("babel-runtime/regenerator"),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=require("babel-runtime/helpers/asyncToGenerator"),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),_promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise),remove=function(){var e=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function r(e){var t,n,a,o,i,l;return _regenerator2["default"].wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t=new _lib2["default"](apiUrl,e,{debug:debug}),r.next=3,t.list();case 3:return n=r.sent,a=n.find(function(e){return e.uid===deploymentId}),r.prev=5,r.next=8,readConfirmation(a);case 8:return o=r.sent.toLowerCase(),"y"!==o&&"yes"!==o&&(console.log("\n> Aborted"),process.exit(0)),i=new Date,r.next=13,t.remove(deploymentId,{hard:hard});case 13:l=(0,_ms2["default"])(new Date-i),console.log(_chalk2["default"].cyan("> Success!")+" Deployment "+_chalk2["default"].bold(deploymentId)+" removed ["+l+"]"),r.next=21;break;case 17:r.prev=17,r.t0=r["catch"](5),(0,_error.handleError)(r.t0),process.exit(1);case 21:t.close();case 22:case"end":return r.stop()}},r,this,[[5,17]])}));return function(r){return e.apply(this,arguments)}}(),_minimist=require("minimist"),_minimist2=_interopRequireDefault(_minimist),_chalk=require("chalk"),_chalk2=_interopRequireDefault(_chalk),_ms=require("ms"),_ms2=_interopRequireDefault(_ms),_textTable=require("text-table"),_textTable2=_interopRequireDefault(_textTable),_lib=require("../lib"),_lib2=_interopRequireDefault(_lib),_login=require("../lib/login"),_login2=_interopRequireDefault(_login),_cfg=require("../lib/cfg"),cfg=_interopRequireWildcard(_cfg),_error=require("../lib/error"),argv=(0,_minimist2["default"])(process.argv.slice(2),{"boolean":["help","debug","hard"],alias:{help:"h",debug:"d"}}),deploymentId=argv._[0],help=function(){console.log("\n  "+_chalk2["default"].bold("ùö´ now remove")+" [deploymentId]\n\n  "+_chalk2["default"].dim("Options:")+"\n\n    -h, --help   output usage information\n    -d, --debug  debug mode [off]\n\n  "+_chalk2["default"].dim("Examples:")+"\n\n  "+_chalk2["default"].gray("‚Äì")+" Remove a deployment identified by "+_chalk2["default"].dim("`deploymentId`")+":\n\n    "+_chalk2["default"].cyan("$ now rm deploymentId")+"\n\n  "+_chalk2["default"].dim("Alias:")+" rm\n")};!argv.help&&deploymentId||(help(),process.exit(0));var debug=argv.debug,apiUrl=argv.url||"https://api.zeit.co",hard=argv.hard||!1,config=cfg.read();_promise2["default"].resolve(config.token||(0,_login2["default"])(apiUrl)).then(function(){var e=(0,_asyncToGenerator3["default"])(_regenerator2["default"].mark(function r(e){return _regenerator2["default"].wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,remove(e);case 3:r.next=9;break;case 5:r.prev=5,r.t0=r["catch"](0),(0,_error.error)("Unknown error: "+r.t0.stack),process.exit(1);case 9:case"end":return r.stop()}},r,void 0,[[0,5]])}));return function(r){return e.apply(this,arguments)}}())["catch"](function(e){(0,_error.error)("Authentication error ‚Äì "+e.message),process.exit(1)});